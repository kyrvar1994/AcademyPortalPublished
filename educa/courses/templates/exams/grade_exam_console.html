{% extends 'base.html' %}
{% block title %}
    Grade Exam Console
{% endblock %}
{% block content %}
    <div class="module exam-console">
        <h2>Grade Exam Console</h2>
        <div class="exam-status-card">
            <h3>{{ exam.title }}</h3>
            <p>Status:
                {% if exam.is_graded %}
                    <span class="badge badge-success">Graded</span>
                {% else %}
                    <span class="badge badge-warning">Ungraded</span>
                {% endif %}
            </p>
        </div>
        <div class="section-header">
            <h3>Student Exams</h3>
        </div>


        <div class="filter-controls">
            <form method="GET" class="filter-form">
                <div class="form-group">
                    <label for="status-filter">Filter by Status:</label>
                    <select name="status" id="status-filter" class="form-control" onchange="this.form.submit()">
                        <option value="all" {% if filter_status == 'all' %}selected{% endif %}>All</option>
                        <option value="graded" {% if filter_status == 'graded' %}selected{% endif %}>Graded</option>
                        <option value="ungraded" {% if filter_status == 'ungraded' %}selected{% endif %}>Ungraded
                        </option>
                    </select>
                </div>
            </form>
        </div>

        {% if attempts %}
            <div class="table-responsive">
                <table class="table">
                    <thead>
                    <tr>
                        <th>Student</th>
                        <th>Grade</th>
                        <th>Status</th>
                        <th>Actions</th>
                    </tr>
                    </thead>
                    <tbody>
                    {% for attempt in attempts %}
                        <tr>
                            <td>{{ attempt.student.first_name }} {{ attempt.student.last_name }}</td>
                            <td>
                                {% if attempt.is_graded %}
                                	{{ attempt.score }} / {{ attempt.exam.total_score }}
                                {% else %}
                                    Not graded
                                {% endif %}
                            </td>
                            <td>
                                {% if attempt.is_graded %}
                                    <span class="badge badge-success">Graded</span>
                                {% else %}
                                    <span class="badge badge-warning">Ungraded</span>
                                {% endif %}
                            </td>
                            <td>
                                <a href="{% url 'grade_student_exam' course_id exam.id attempt.pk %}">Grade</a>
                            </td>
                        </tr>
                    {% endfor %}
                    </tbody>
                </table>
            </div>
        {% else %}
            <div class="no-data-message">
                <p>No student exams yet.</p>
            </div>
        {% endif %}
        <div class="actions" style="padding: 0">
            <a href="{% url 'exam_manage' course_id %}" class="btn btn-secondary">Back to Exams</a>
            <a href="{% url 'exam_analytics' course_id exam.id %}" class="btn btn-primary">View Analytics</a>
        </div>
    </div>
{% endblock %}