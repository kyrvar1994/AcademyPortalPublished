{% extends 'base.html' %}
{% block title %}
    Payment Receipt
{% endblock %}
{% block content %}
    <div class="receipt">
        <div class="receipt-watermark">PAID</div>
        <div class="receipt-header">
            <div class="row">
                <div class="col-md-6">
                    <div class="logo-placeholder">
                        <i class="fas fa-graduation-cap fa-2x"></i>
                        <h3>Academy Portal</h3>
                    </div>
                    <div class="company-info">
                        <p>123 Fake Street, Fake Town, Fake Country</p>
                        <p>Phone: 123 456 7890 | Email: test@example.com</p>
                        <p>VAT: 123456789</p>
                    </div>
                </div>
                <div class="col-md-6 text-right">
                    <div class="receipt-number">
                        <h2>RECEIPT</h2>
                        <div class="receipt-id">#{{ transaction.receipt_number }}</div>
                        <div class="receipt-date">{{ transaction.payment_date|date:"d/m/Y H:i" }}</div>
                    </div>
                </div>
            </div>
        </div>

        <div class="receipt-body">
            <div class="row">
                <div class="col-md-6">
                    <div class="student-info">
                        <h4><i class="fas fa-user"></i> Student Information</h4>
                        <div class="info-box">
                            <p><strong>Name:</strong> {{ transaction.student.get_full_name }}</p>
                            <p><strong>Email:</strong> {{ transaction.student.email }}</p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-md-6">
                <div class="payment-details">
                    <h4><i class="fas fa-credit-card"></i> Payment Details</h4>
                    <div class="info-box">
                        <p><strong>Payment Method:</strong> Credit Card</p>
                        <p><strong>Transaction ID:</strong> {{ transaction.transaction_id }}</p>
                        <p><strong>Status:</strong> <span class="payment-status">{{ transaction.get_status_display }}</span>
                        </p>
                    </div>
                </div>
            </div>

            <div class="course-info" style="flex-direction: column;">
                <h4><i class="fas fa-book"></i> Course Information</h4>
                <table class="table table-receipt">
                    <thead>
                    <tr>
                        <th>Course</th>
                        <th>Academic Year</th>
                        <th>Amount</th>
                    </tr>
                    </thead>
                    <tbody>
                    {% for payment in transaction.payments.all %}
                        <tr>
                            <td>{{ payment.enrollment.course.title }}</td>
                            <td>{{ payment.enrollment.academic_year.name }}</td>
                            <td class="amount">{{ payment.amount }}€</td>
                        </tr>
                    {% endfor %}
                    <tr class="total-row">
                        <td colspan="2" class="text-right"><strong>Total</strong></td>
                        <td class="amount"><strong>{{ transaction.total_amount }}€</strong></td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <div class="receipt-footer">
            <div class="thank-you-message">
                <h4><strong>Thank you for your purchase!</strong></h4>
                <p>This receipt serves as proof of payment for the course enrollment(s).</p>
            </div>

            <div class="receipt-barcode">
                <i class="fas fa-barcode fa-2x"></i>
                <div class="small">{{ transaction.receipt_number }}</div>
            </div>
        </div>

        <div class="no-print text-center mt-4">
            <button onclick="printReceipt()" class="btn btn-primary">
                <i class="fas fa-print"></i> Print/Save as PDF
            </button>
            {% if not request.user.is_staff %}
                <a href="{% url 'student_receipts' %}" class="btn btn-secondary">
                    <i class="fas fa-arrow-left"></i> Back
                </a>
            {% endif %}

            <div class="mt-2 text-muted">
                <small>
                    <i class="fas fa-info-circle"></i>
                    To save as PDF, select "Save as PDF" in the printer destination dropdown when the print dialog
                    appears.
                </small>
            </div>
        </div>
    </div>

    <script>
        function printReceipt() {
            window.print();
        }
    </script>
{% endblock %}